namespace :wc do
  desc "Set new field vat_net_first to false for each account"
  task :pop_event_taggings_kommunalakademie => :environment do

    # kill all records for tag 491
    Event::Tagging.all.where(account_id: 1458, event_tag_id: 491).destroy_all

    # set of event.ids that should receive a new tag
    # ["8457","8458","8459","8460","8461","8462","8463","8464","8465","8466","8467","8468","8469","8470","8471","8472","8473","8474","8475","8476","8480","8481","8482","8483","8484","8485","8489","8490","8491","8492","8493","8494","8495","8496","8497","8498","8499","8500","8501","8502","8503","8504","8505","8506","8508","8509","8510","8511","8512","8513","8515","8516","8517","8518","8519","8520","8521","8522","8523","8542","8543","8549","8550","8551","8552","8553","8554","8555","8557","8558","8559","8560","8561","8562","8563","8564","8565","8566","8567","8568","8569","8570","8571","8588","8589","8590","8591","8592","8594","8747","8748","8749","8750","8751","8752","8753","8754","8755","8756","8757","8758","8759","8760","8761","8762","8763","8764","8765","8766","8767","8768","8769","8770","8771","8772","8773","8774","8775","8776","8777","8778","8779","8780","8781","8782","8783","8784","8785","8786","8787","8788","8789","8790","8791","8792","8793","8794","8795","8796","8797","8798","8799","8800","8801","8802","8803","8804","8805","8806","8807","8808","8809","8810","8811","8812","8813","8814","8815","8816","8817","8818","8819","8820","8821","8822","8823","8824","8825","8826","8827","8828","8829","8830","8831","8832","8833","8834","8835","8836","8837","8838","8839","8840","8841","8842","8843","8844","8845","8846","8847","8848","8849","8850","8851","8852","8853","8854","8855","8856","8857","8858","8859","8860","8861","8862","8863","8864","8865","8866","29712","29908"].each do |event_id|
    Event.all.joins("LEFT JOIN event_taggings ON events.id=event_taggings.event_id").where("event_taggings.id IS NULL AND events.account_id=1458").each do |event|
      puts "Event: " + Event.find(event.id).to_s
      # start transaction to avoid error when duplicate entry in event_taggings
      begin
        Event::Tagging.create({
          account_id: 1458,
          event_id: event.id,
          event_tag_id: 491
          })
      rescue StandardError => e
        puts "Record exists or whatever error: #{e.inspect}"
      end


    end
  end
end
